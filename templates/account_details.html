<html>
<head>
  <!-- // <script src="./static/jquery-3.5.1.min.js" type="text/javascript"></script> -->
	<title>GET ACCOUNT DETAILS</title>
  <script src="./static/fetchapi.js" type="text/javascript"></script>
</head>
<body>
  <script>
    current_selected_account_id = "";

    function deposit_withdraw_transfer(d=0,t=0,w=0){
      if (d == 1){

        data = {account_id:current_selected_account_id};

        postData('/deposit', data)
          .then(data => {
            console.log(data); // JSON data parsed by `response.json()` call
            // refill data
            if (data["message"] == "error"){
              alert("something went wrong!");
            }
            else{
              alert("deposited");
            }

          });        

      }
      else if (t==1){
        data = {account_id:current_selected_account_id};

        postData('/transfer', data)
          .then(data => {
            console.log(data); // JSON data parsed by `response.json()` call
            // refill data
            if (data["message"] == "error"){
              alert("something went wrong!");
            }
            else{
              alert("deposited");
            }

          }); 
      }
      else{
        data = {account_id:current_selected_account_id};

        postData('/withdraw', data)
          .then(data => {
            console.log(data); // JSON data parsed by `response.json()` call
            // refill data
            if (data["message"] == "error"){
              alert("something went wrong!");
            }
            else{
              alert("deposited");
            }

          }); 
      }
    }

    function select_account(passed_data = "not_given",id="accounts"){

      single_account_details = document.getElementById("single_account_details");
      single_account_details.style.display = "";

      selected_account = document.getElementById(id);

      current_selected_account_id = selected_account.value;

      if (passed_data == "not_given"){
        
        console.log(selected_account.value);

        data = {account_id:selected_account.value};
      }
      else{
        data = passed_data;
      }


      postData('/get_single_account_detail', data)
        .then(data => {
          console.log(data); // JSON data parsed by `response.json()` call
          // refill data
          if (data["message"] == "error"){
            alert("something went wrong!");
          }
          else{
            document.getElementById("single_account_details").style.display = "";
            document.getElementById("customer_id").value = data["customer_id"];
            document.getElementById("display_account_id").value = data["account_id"];
            document.getElementById("account_type").value = data["account_type"];
            document.getElementById("balance").value = data["balance"];
            
          }

        });

    }

    function get_acount_details(){

      document.getElementById("deposit_withdraw_transfer").style.display="";

      var customer_ssn_id = document.getElementById('customer_ssn_id');
      var account_id = document.getElementById('account_id');

      if (customer_ssn_id.value == "" && account_id.value == ""){
        alert("enter either ssn or id");
        location.reload();
      }
      else if(customer_ssn_id.value != "" && account_id.value != ""){
        alert("don't enter both ssn and id");
        location.reload();
      }
      else{

        // if ssn is given instead of account id
        if (customer_ssn_id.value != ""){
          document.getElementById("single_account_details").style.display = "none";
          var data = {customer_ssn_id: customer_ssn_id.value,
          account_id: account_id.value,
          };

          postData('/account_details', data)
            .then(data => {
              console.log(data); // JSON data parsed by `response.json()` call
              // refill data
              if (data["message"] == "error"){
                alert("something went wrong!");
              }
              else{
                  // display the accounts or account detail
                  
                  var details_div = document.getElementById("details_div");
                  details_div.style.display = "";
                  var x = document.getElementById("accounts");
                  x.remove();
                  var x = document.createElement("SELECT");
                  x.setAttribute("id", "accounts");
                  x.setAttribute("onchange", "select_account()");
                  details_div.appendChild(x);

                  var option = document.createElement("option");
                  option.text = "select_one";
                  x.add(option);
                  
                  for (i = 0; i < data.length; i++) {
                    var option = document.createElement("option");
                    option.text = data[i];
                    x.add(option);
                  }

                  // alert(data["message"]);
              }

            });

        }
        // if account id is given
        else{
          // disable the accounts list dropdown when a specific account id is given
          var acc = document.getElementById("details_div");
          acc.style.display = "none";
          console.log("asdasd");
          select_account(passed_data = data,id='account_id');
        }

      }

    }

  </script>
  <form>
    <div class="container">
      <label for="customer_ssn_id"><b>Customer SSN ID</b></label>
      <input type="text" id="customer_ssn_id"><br>
      <div>
        <h4>OR</h4>
      </div>
      <label for="account_id"><b>Account ID</b></label>
      <input type="text" id="account_id"><br>

          
      <button type="button" onclick="get_acount_details()">Get Detials</button><br><br>
      

    </div>
  </form>

    <div style="display:none;" id="details_div">
      <label for="accounts"><b>accounts</b></label>
      <select id="accounts" name="accounts" onchange="select_account()">

      </select><br>
    </div><br>

    <div style="display:none;" id="single_account_details">
      <label for="customer_id"><b>Customer ID</b></label>
      <input type="text" id="customer_id" readonly><br>

      <label for="display_account_id"><b>Account ID</b></label>
      <input type="text" id="display_account_id" readonly><br>

      <label for="account_type"><b>Account type</b></label>
      <input type="text" id="account_type" readonly><br>

      <label for="balance"><b>Balance</b></label>
      <input type="text" id="balance" readonly><br>
    </div><br>

    <div id="deposit_withdraw_transfer" style="display:none;">
      <button type="button" onclick="deposit_withdraw_transfer(d=1)">Deposit</button><br><br>
      <button type="button" onclick="deposit_withdraw_transfer(w=1)">withdraw</button><br><br>
      <button type="button" onclick="deposit_withdraw_transfer(t=1)">transfer</button><br><br>
    </div>

</body>
</html>



